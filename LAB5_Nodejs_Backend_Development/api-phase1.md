# Phase 1 Enhanced: Agent Wallboard API with Professional Structure

## üìã **Phase 1 ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°**

### üéØ **Phase 1 ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Agent Wallboard ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend (Desktop Apps)        ‚îÇ  ‚Üê Phase 4: Electron.js
‚îÇ   ‚Ä¢ Agent App ‚Ä¢ Supervisor App   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ HTTP/REST + WebSocket
                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Backend API (Phase 1 ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ!)    ‚îÇ  ‚Üê Node.js + Express
‚îÇ   ‚Ä¢ REST APIs ‚Ä¢ Validation       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ Database Connections
                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Database (Phase 2‚Äì3)           ‚îÇ  ‚Üê MSSQL + MongoDB
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

```

### üìö **‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÉ‡∏ô Phase 1:**
- ‚úÖ **Professional Node.js API Development** - ‚úÖ **MVC Architecture Pattern**
- ‚úÖ **Input Validation with Joi**
- ‚úÖ **Error Handling & Middleware**
- ‚úÖ **API Testing & Documentation**
- ‚úÖ **Code Organization Best Practices**

### ‚è∞ **Time Allocation (4.5 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á):**
- **Hour 1:** Setup + Project Structure (70 ‡∏ô‡∏≤‡∏ó‡∏µ)
- **Hour 2:** Models + Controllers (70 ‡∏ô‡∏≤‡∏ó‡∏µ)  
- **Hour 3:** Validation + Error Handling (70 ‡∏ô‡∏≤‡∏ó‡∏µ)
- **Hour 4:** Testing + Integration (70 ‡∏ô‡∏≤‡∏ó‡∏µ)

---

## ‚è∞ **HOUR 1: Project Setup & Structure (70 ‡∏ô‡∏≤‡∏ó‡∏µ)**

### üöÄ **Step 1: Project Initialization (15 ‡∏ô‡∏≤‡∏ó‡∏µ)**

```bash
# 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ
mkdir agent-wallboard-api
cd agent-wallboard-api

# 2. Initialize npm
npm init -y

# 3. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies
npm install express cors dotenv joi helmet morgan
npm install --save-dev nodemon

# 4. ‡∏™‡∏£‡πâ‡∏≤‡∏á folder structure
mkdir controllers middleware models routes utils
touch server.js .env .gitignore README.md
````

### üìÅ **Step 2: Professional Project Structure (15 ‡∏ô‡∏≤‡∏ó‡∏µ)**

```
agent-wallboard-api/
‚îú‚îÄ‚îÄ üìÅ controllers/          # Business logic
‚îÇ   ‚îî‚îÄ‚îÄ agentController.js   
‚îú‚îÄ‚îÄ üìÅ middleware/          # Request processing
‚îÇ   ‚îú‚îÄ‚îÄ validation.js       
‚îÇ   ‚îî‚îÄ‚îÄ errorHandler.js     
‚îú‚îÄ‚îÄ üìÅ models/             # Data models  
‚îÇ   ‚îî‚îÄ‚îÄ Agent.js            
‚îú‚îÄ‚îÄ üìÅ routes/             # API routes
‚îÇ   ‚îú‚îÄ‚îÄ agents.js           
‚îÇ   ‚îî‚îÄ‚îÄ index.js            
‚îú‚îÄ‚îÄ üìÅ utils/              # Helper functions
‚îÇ   ‚îú‚îÄ‚îÄ constants.js        
‚îÇ   ‚îî‚îÄ‚îÄ apiResponse.js      
‚îú‚îÄ‚îÄ üìÑ server.js           # Main application
‚îú‚îÄ‚îÄ üìÑ package.json
‚îú‚îÄ‚îÄ üìÑ .env                # Environment variables
‚îú‚îÄ‚îÄ üìÑ .env.example        # Environment template
‚îî‚îÄ‚îÄ üìÑ README.md          # Documentation
```

### ‚öôÔ∏è **Step 3: Environment Configuration (10 ‡∏ô‡∏≤‡∏ó‡∏µ)**

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `.env.example`:**

```env
# Server Configuration
PORT=3001
NODE_ENV=development

# CORS Configuration  
FRONTEND_URL=http://localhost:3000

# Future: Database Configuration (Phase 2)
# DB_CONNECTION_STRING=your-database-url
# JWT_SECRET=your-super-secret-key
```

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `.env`:**

```env
PORT=3001
NODE_ENV=development
FRONTEND_URL=http://localhost:3000
```

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `.gitignore`:**

```gitignore
node_modules/
.env
.DS_Store
*.log
logs/
dist/
```

### üì¶ **Step 4: Package.json Scripts (10 ‡∏ô‡∏≤‡∏ó‡∏µ)**

**‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó `package.json`:**

```json
{
  "name": "agent-wallboard-api-enhanced",
  "version": "1.0.0",
  "description": "Agent Wallboard API with Professional Structure",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js",
    "test": "echo 'Run Postman tests - see README.md'",
    "docs": "echo 'API Documentation: http://localhost:3001/api/docs'"
  },
  "keywords": ["agent", "wallboard", "api", "callcenter"],
  "author": "Your Name",
  "dependencies": {
    "express": "^4.18.2", 
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "joi": "^17.11.0",
    "helmet": "^7.1.0",
    "morgan": "^1.10.0"
  },
  "devDependencies": {
    "nodemon": "^3.0.1"
  }
}
```

### üîß **Step 5: Core Constants (20 ‡∏ô‡∏≤‡∏ó‡∏µ)**

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `utils/constants.js`:**

```javascript
// utils/constants.js - ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö
const AGENT_STATUS = {
  AVAILABLE: 'Available',
  BUSY: 'Busy',
  WRAP: 'Wrap', 
  BREAK: 'Break',
  NOT_READY: 'Not Ready',
  OFFLINE: 'Offline'
};

const DEPARTMENTS = [
  'Sales',
  'Support', 
  'Technical',
  'General',
  'Supervisor'
];

// ‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
const VALID_STATUS_TRANSITIONS = {
  'Available': ['Busy', 'Break', 'Not Ready', 'Offline'],
  'Busy': ['Available', 'Wrap', 'Not Ready'],
  'Wrap': ['Available', 'Not Ready'],
  'Break': ['Available', 'Not Ready'],
  'Not Ready': ['Available', 'Offline'],
  'Offline': ['Available']
};

const API_MESSAGES = {
  AGENT_NOT_FOUND: 'Agent not found',
  AGENT_CREATED: 'Agent created successfully',
  AGENT_UPDATED: 'Agent updated successfully',
  AGENT_DELETED: 'Agent deleted successfully',
  STATUS_UPDATED: 'Agent status updated successfully',
  VALIDATION_FAILED: 'Validation failed',
  INTERNAL_ERROR: 'Internal server error'
};

module.exports = { 
  AGENT_STATUS, 
  DEPARTMENTS, 
  VALID_STATUS_TRANSITIONS,
  API_MESSAGES
};
```

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `utils/apiResponse.js`:**

```javascript
// utils/apiResponse.js - Consistent API responses
const sendSuccess = (res, message, data = null, statusCode = 200) => {
  const response = {
    success: true,
    message,
    timestamp: new Date().toISOString()
  };

  if (data !== null) {
    if (Array.isArray(data)) {
      response.count = data.length;
    }
    response.data = data;
  }

  return res.status(statusCode).json(response);
};

const sendError = (res, message, statusCode = 400, errors = null) => {
  const response = {
    success: false,
    message,
    timestamp: new Date().toISOString()
  };

  if (errors) {
    response.errors = errors;
  }

  return res.status(statusCode).json(response);
};

module.exports = { sendSuccess, sendError };
```

-----

## ‚è∞ **HOUR 2: Models & Controllers (70 ‡∏ô‡∏≤‡∏ó‡∏µ)**

### üìä **Step 6: Enhanced Agent Model (25 ‡∏ô‡∏≤‡∏ó‡∏µ - ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ + ‡πÉ‡∏´‡πâ code ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)**

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `models/Agent.js`:**

```javascript
// models/Agent.js - Enhanced Agent model with methods
// üëâ ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á "Agent" object ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô call center
// üëâ ‡πÉ‡∏ô Phase 1 ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ Database ‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô memory (Map) ‡∏Å‡πà‡∏≠‡∏ô

class Agent {
  constructor(data) {
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á unique id (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤) ‡∏î‡πâ‡∏ß‡∏¢ generateId()
    this.id = data.id || this.generateId();

    // ‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß agent (‡πÄ‡∏ä‡πà‡∏ô A001)
    this.agentCode = data.agentCode;

    // ‡∏ä‡∏∑‡πà‡∏≠-‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡πÅ‡∏ú‡∏ô‡∏Å
    this.name = data.name;
    this.email = data.email;
    this.department = data.department || 'General';

    // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ (skills ‡πÄ‡∏ä‡πà‡∏ô ‡∏†‡∏≤‡∏©‡∏≤, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏î‡πâ‡∏≤‡∏ô)
    this.skills = data.skills || [];

    // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô = Available
    this.status = data.status || 'Available';

    // ‡∏ö‡πà‡∏á‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤ agent ‡∏¢‡∏±‡∏á active ‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏´‡∏°
    this.isActive = data.isActive !== undefined ? data.isActive : true;

    // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà login ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
    this.loginTime = data.loginTime || null;

    // ‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    this.lastStatusChange = new Date();

    // ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    this.statusHistory = data.statusHistory || [];

    // ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    this.createdAt = data.createdAt || new Date();
    this.updatedAt = new Date();
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á id ‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏° ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Phase 1 (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ database)
  generateId() {
    return Date.now() + Math.random().toString(36).substr(2, 9);
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
  updateStatus(newStatus, reason = null) {
    this.statusHistory.push({
      from: this.status,
      to: newStatus,
      reason,
      timestamp: new Date()
    });

    this.status = newStatus;
    this.lastStatusChange = new Date();
    this.updatedAt = new Date();
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ JSON (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö API response)
  toJSON() {
    return {
      id: this.id,
      agentCode: this.agentCode,
      name: this.name,
      email: this.email,
      department: this.department,
      skills: this.skills,
      status: this.status,
      isActive: this.isActive,
      loginTime: this.loginTime,
      lastStatusChange: this.lastStatusChange,
      createdAt: this.createdAt,
      updatedAt: this.updatedAt
    };
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡πâ admin ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  getStatusHistory() {
    return this.statusHistory;
  }
}

// ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö agent ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Map (‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô database ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)
const agents = new Map();

// ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á sample data ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö API
function initializeSampleData() {
  const sampleAgents = [
    {
      agentCode: 'A001',
      name: 'John Doe', 
      email: 'john.doe@company.com',
      department: 'Sales',
      skills: ['Thai', 'English', 'Sales'],
      status: 'Available'
    },
    {
      agentCode: 'A002',
      name: 'Jane Smith',
      email: 'jane.smith@company.com', 
      department: 'Support',
      skills: ['Thai', 'Technical Support'],
      status: 'Busy'
    },
    {
      agentCode: 'S001',
      name: 'Sarah Wilson',
      email: 'sarah.wilson@company.com',
      department: 'Technical', 
      skills: ['English', 'Technical', 'Supervisor'],
      status: 'Available'
    }
  ];

  // ‡πÄ‡∏û‡∏¥‡πà‡∏° agent ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏Ç‡πâ‡∏≤ Map
  sampleAgents.forEach(data => {
    const agent = new Agent(data);
    agents.set(agent.id, agent);
  });

  console.log(`‚úÖ Initialized ${agents.size} sample agents`);
}

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á sample data ‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
initializeSampleData();

module.exports = { Agent, agents };

```

### üéÆ **Step 7: Controllers - ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏≥‡πÄ‡∏≠‡∏á (30 ‡∏ô‡∏≤‡∏ó‡∏µ)**

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `controllers/agentController.js`:**

```javascript
// controllers/agentController.js - Business logic ‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å routes
const { Agent, agents } = require('../models/Agent');
const { AGENT_STATUS, VALID_STATUS_TRANSITIONS, API_MESSAGES } = require('../utils/constants');
const { sendSuccess, sendError } = require('../utils/apiResponse');

const agentController = {
  // ‚úÖ ‡πÉ‡∏´‡πâ code ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
  // GET /api/agents/:id
  getAgentById: (req, res) => {
    try {
      const { id } = req.params;
      const agent = agents.get(id);

      if (!agent) {
        return sendError(res, API_MESSAGES.AGENT_NOT_FOUND, 404);
      }

      console.log(`üìã Retrieved agent: ${agent.agentCode}`);
      return sendSuccess(res, 'Agent retrieved successfully', agent.toJSON());
    } catch (error) {
      console.error('Error in getAgentById:', error);
      return sendError(res, API_MESSAGES.INTERNAL_ERROR, 500);
    }
  },

  // üîÑ TODO #1: ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏≥‡πÄ‡∏≠‡∏á (10 ‡∏ô‡∏≤‡∏ó‡∏µ)
  // GET /api/agents
  getAllAgents: (req, res) => {
    try {
      // TODO: ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• agents ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Map
      // Hint: ‡πÉ‡∏ä‡πâ Array.from(agents.values())
      
      // TODO: Filter ‡∏ï‡∏≤‡∏° query parameters
      // Hint: req.query.status ‡πÅ‡∏•‡∏∞ req.query.department
      
      // TODO: ‡∏™‡πà‡∏á response ‡∏î‡πâ‡∏ß‡∏¢ sendSuccess
      // Hint: sendSuccess(res, message, data)
      
      return sendError(res, 'TODO: Implement getAllAgents function', 501);
    } catch (error) {
      console.error('Error in getAllAgents:', error);
      return sendError(res, API_MESSAGES.INTERNAL_ERROR, 500);
    }
  },

  // üîÑ TODO #2: ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏≥‡πÄ‡∏≠‡∏á (15 ‡∏ô‡∏≤‡∏ó‡∏µ)  
  // POST /api/agents
  createAgent: (req, res) => {
    try {
      const agentData = req.body;

      // TODO: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ agentCode ‡∏ã‡πâ‡∏≥‡πÑ‡∏´‡∏°
      // Hint: ‡πÉ‡∏ä‡πâ Array.from(agents.values()).find()
      
      // TODO: ‡∏™‡∏£‡πâ‡∏≤‡∏á Agent ‡πÉ‡∏´‡∏°‡πà
      // Hint: const newAgent = new Agent(agentData);
      
      // TODO: ‡πÄ‡∏Å‡πá‡∏ö‡∏•‡∏á Map
      // Hint: agents.set(newAgent.id, newAgent);
      
      // TODO: ‡∏™‡πà‡∏á response ‡∏û‡∏£‡πâ‡∏≠‡∏° status 201
      
      return sendError(res, 'TODO: Implement createAgent function', 501);
    } catch (error) {
      console.error('Error in createAgent:', error);
      return sendError(res, API_MESSAGES.INTERNAL_ERROR, 500);
    }
  },

  // ‚úÖ ‡πÉ‡∏´‡πâ code ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
  // PUT /api/agents/:id
  updateAgent: (req, res) => {
    try {
      const { id } = req.params;
      const agent = agents.get(id);

      if (!agent) {
        return sendError(res, API_MESSAGES.AGENT_NOT_FOUND, 404);
      }

      const { name, email, department, skills } = req.body;
      
      // Update allowed fields
      if (name) agent.name = name;
      if (email) agent.email = email;
      if (department) agent.department = department;
      if (skills) agent.skills = skills;
      
      agent.updatedAt = new Date();
      
      console.log(`‚úèÔ∏è Updated agent: ${agent.agentCode}`);
      return sendSuccess(res, API_MESSAGES.AGENT_UPDATED, agent.toJSON());
    } catch (error) {
      console.error('Error in updateAgent:', error);
      return sendError(res, API_MESSAGES.INTERNAL_ERROR, 500);
    }
  },

  // üîÑ TODO #3: ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏≥‡πÄ‡∏≠‡∏á (15 ‡∏ô‡∏≤‡∏ó‡∏µ - ‡∏¢‡∏≤‡∏Å‡∏™‡∏∏‡∏î)
  // PATCH /api/agents/:id/status  
  updateAgentStatus: (req, res) => {
    try {
      const { id } = req.params;
      const { status, reason } = req.body;

      // TODO: ‡∏´‡∏≤ agent ‡∏à‡∏≤‡∏Å id
      // TODO: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ agent ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏´‡∏°
      // TODO: validate status ‡∏î‡πâ‡∏ß‡∏¢ AGENT_STATUS  
      // TODO: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö valid transition ‡∏î‡πâ‡∏ß‡∏¢ VALID_STATUS_TRANSITIONS
      // TODO: ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å agent.updateStatus(status, reason)
      // TODO: ‡∏™‡πà‡∏á response ‡∏Å‡∏•‡∏±‡∏ö

      return sendError(res, 'TODO: Implement updateAgentStatus function', 501);
    } catch (error) {
      console.error('Error in updateAgentStatus:', error);
      return sendError(res, API_MESSAGES.INTERNAL_ERROR, 500);
    }
  },

  // ‚úÖ ‡πÉ‡∏´‡πâ code ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
  // DELETE /api/agents/:id
  deleteAgent: (req, res) => {
    try {
      const { id } = req.params;
      const agent = agents.get(id);

      if (!agent) {
        return sendError(res, API_MESSAGES.AGENT_NOT_FOUND, 404);
      }

      agents.delete(id);
      
      console.log(`üóëÔ∏è Deleted agent: ${agent.agentCode} - ${agent.name}`);
      return sendSuccess(res, API_MESSAGES.AGENT_DELETED);
    } catch (error) {
      console.error('Error in deleteAgent:', error);
      return sendError(res, API_MESSAGES.INTERNAL_ERROR, 500);
    }
  },

  // ‚úÖ ‡πÉ‡∏´‡πâ code ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - Dashboard API
  // GET /api/agents/status/summary
  getStatusSummary: (req, res) => {
    try {
      const agentList = Array.from(agents.values());
      const totalAgents = agentList.length;
      
      const statusCounts = {};
      Object.values(AGENT_STATUS).forEach(status => {
        statusCounts[status] = agentList.filter(agent => agent.status === status).length;
      });

      const statusPercentages = {};
      Object.entries(statusCounts).forEach(([status, count]) => {
        statusPercentages[status] = totalAgents > 0 ? Math.round((count / totalAgents) * 100) : 0;
      });

      const summary = {
        totalAgents,
        statusCounts,
        statusPercentages,
        lastUpdated: new Date().toISOString()
      };

      return sendSuccess(res, 'Status summary retrieved successfully', summary);
    } catch (error) {
      console.error('Error in getStatusSummary:', error);
      return sendError(res, API_MESSAGES.INTERNAL_ERROR, 500);
    }
  }
};

module.exports = agentController;
```

### üìù **TODO Completion Guide ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤:**

#### **TODO \#1: getAllAgents (10 ‡∏ô‡∏≤‡∏ó‡∏µ)**

```javascript
// Solution hints:
getAllAgents: (req, res) => {
  try {
    const { status, department } = req.query;
    let agentList = Array.from(agents.values());

    // Filter by status
    if (status) {
      agentList = agentList.filter(agent => agent.status === status);
    }
    
    // Filter by department  
    if (department) {
      agentList = agentList.filter(agent => agent.department === department);
    }

    console.log(`üìã Retrieved ${agentList.length} agents`);
    return sendSuccess(res, 'Agents retrieved successfully', 
      agentList.map(agent => agent.toJSON())
    );
  } catch (error) {
    console.error('Error in getAllAgents:', error);
    return sendError(res, API_MESSAGES.INTERNAL_ERROR, 500);
  }
}
```

-----

## ‚è∞ **HOUR 3: Validation & Error Handling (70 ‡∏ô‡∏≤‡∏ó‡∏µ) ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á**

### ‚úÖ **Step 8: Joi Validation - ‡∏ú‡∏™‡∏°‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ code ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡πÄ‡∏≠‡∏á (35 ‡∏ô‡∏≤‡∏ó‡∏µ)**

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `middleware/validation.js`:**

```javascript
// middleware/validation.js - Professional validation with Joi
const Joi = require('joi');
const { AGENT_STATUS, DEPARTMENTS } = require('../utils/constants');
const { sendError } = require('../utils/apiResponse');

// Validation schemas
const schemas = {
  // ‚úÖ ‡πÉ‡∏´‡πâ code ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
  agent: Joi.object({
    agentCode: Joi.string()
      .pattern(/^[A-Z]\d{3}$/)
      .required()
      .messages({
        'string.pattern.base': 'Agent code must be in format A001 (letter + 3 digits)',
        'any.required': 'Agent code is required'
      }),
    
    name: Joi.string()
      .min(2)
      .max(100)
      .required()
      .messages({
        'string.min': 'Name must be at least 2 characters',
        'string.max': 'Name cannot exceed 100 characters',
        'any.required': 'Name is required'
      }),
    
    email: Joi.string()
      .email()
      .required()
      .messages({
        'string.email': 'Please provide a valid email address',
        'any.required': 'Email is required'
      }),
    
    department: Joi.string()
      .valid(...DEPARTMENTS)
      .default('General')
      .messages({
        'any.only': `Department must be one of: ${DEPARTMENTS.join(', ')}`
      }),
    
    skills: Joi.array()
      .items(Joi.string().min(2).max(50))
      .default([])
      .messages({
        'array.base': 'Skills must be an array of strings'
      })
  }),

  // üîÑ TODO #4: ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏≥‡πÄ‡∏≠‡∏á (15 ‡∏ô‡∏≤‡∏ó‡∏µ)
  statusUpdate: Joi.object({
    // TODO: ‡∏™‡∏£‡πâ‡∏≤‡∏á validation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö status update
    // Requirements:
    // 1. status ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô valid AGENT_STATUS
    // 2. reason ‡πÄ‡∏õ‡πá‡∏ô optional string ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 200 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
    // 3. ‡πÉ‡∏™‡πà error messages ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
    
    // Hint structure:
    // status: Joi.string().valid(...).required().messages({...}),
    // reason: Joi.string().max(200).optional().messages({...})
  })
};

// Validation middleware functions
const validateAgent = (req, res, next) => {
  const { error, value } = schemas.agent.validate(req.body, {
    abortEarly: false,
    stripUnknown: true
  });

  if (error) {
    const validationErrors = error.details.map(detail => ({
      field: detail.path[0],
      message: detail.message
    }));

    console.log('‚ùå Validation failed:', validationErrors);
    return sendError(res, 'Validation failed', 400, validationErrors);
  }

  req.body = value;
  next();
};

// üîÑ TODO #5: ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏≥‡πÄ‡∏≠‡∏á (10 ‡∏ô‡∏≤‡∏ó‡∏µ)
const validateStatusUpdate = (req, res, next) => {
  // TODO: implement ‡∏ï‡∏≤‡∏° pattern ‡∏Ç‡∏≠‡∏á validateAgent
  // Hint: ‡πÉ‡∏ä‡πâ schemas.statusUpdate ‡πÅ‡∏ó‡∏ô schemas.agent
  
  return sendError(res, 'TODO: Implement validateStatusUpdate middleware', 501);
};

module.exports = {
  validateAgent,
  validateStatusUpdate
};
```

---

‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ **middleware ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Validation) ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Joi**
‡∏ã‡∏∂‡πà‡∏á‡∏ó‡∏≥‡πÉ‡∏´‡πâ API ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö

---

## üìå ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô

### 1) import modules

```javascript
const Joi = require('joi');
const { AGENT_STATUS, DEPARTMENTS } = require('../utils/constants');
const { sendError } = require('../utils/apiResponse');
```

* `Joi` ‚Üí ‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö validation ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° schema
* `AGENT_STATUS, DEPARTMENTS` ‚Üí constants ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ ‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
* `sendError` ‚Üí helper function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á response ‡πÄ‡∏°‡∏∑‡πà‡∏≠ validation ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß

---

### 2) ‡∏™‡∏£‡πâ‡∏≤‡∏á **schemas** (‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö validation)

```javascript
const schemas = {
  agent: Joi.object({
    agentCode: Joi.string()
      .pattern(/^[A-Z]\d{3}$/)
      .required()
      .messages({
        'string.pattern.base': 'Agent code must be in format A001 (letter + 3 digits)',
        'any.required': 'Agent code is required'
      }),
    
    name: Joi.string()
      .min(2)
      .max(100)
      .required()
      .messages({
        'string.min': 'Name must be at least 2 characters',
        'string.max': 'Name cannot exceed 100 characters',
        'any.required': 'Name is required'
      }),
    
    email: Joi.string()
      .email()
      .required()
      .messages({
        'string.email': 'Please provide a valid email address',
        'any.required': 'Email is required'
      }),
    
    department: Joi.string()
      .valid(...DEPARTMENTS)
      .default('General')
      .messages({
        'any.only': `Department must be one of: ${DEPARTMENTS.join(', ')}`
      }),
    
    skills: Joi.array()
      .items(Joi.string().min(2).max(50))
      .default([])
      .messages({
        'array.base': 'Skills must be an array of strings'
      })
  }),
```

üìñ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢:

* `agentCode` ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‡πÄ‡∏ä‡πà‡∏ô `A001` (‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ 1 ‡∏ï‡∏±‡∏ß + ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 3 ‡∏´‡∏•‡∏±‡∏Å) ‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≤‡∏°‡∏ß‡πà‡∏≤‡∏á
* `name` ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 100 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
* `email` ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
* `department` ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (`Sales`, `Support`, ‡∏Ø‡∏•‡∏Ø) ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà default = `General`
* `skills` ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô array ‡∏Ç‡∏≠‡∏á string ‡πÄ‡∏ä‡πà‡∏ô `["Thai","English"]`

---

### 3) Schema ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö **update status** (‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô TODO)

```javascript
statusUpdate: Joi.object({
  // TODO: ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ status ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô AGENT_STATUS ‡πÅ‡∏•‡∏∞ reason ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 200 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
})
```

üëâ ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÄ‡∏≠‡∏á:

* `status`: ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á `AGENT_STATUS` ‡πÅ‡∏•‡∏∞ required
* `reason`: ‡πÄ‡∏õ‡πá‡∏ô optional string ‡∏¢‡∏≤‡∏ß‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 200 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£

---

### 4) Middleware function: **validateAgent**

```javascript
const validateAgent = (req, res, next) => {
  const { error, value } = schemas.agent.validate(req.body, {
    abortEarly: false,
    stripUnknown: true
  });
```

üìñ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢:

* `schemas.agent.validate(req.body)` ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà client ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
* `abortEarly: false` ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏ô‡∏´‡∏°‡∏î‡∏ó‡∏∏‡∏Å field (‡πÑ‡∏°‡πà‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠ error ‡πÅ‡∏£‡∏Å)
* `stripUnknown: true` ‚Üí ‡∏ï‡∏±‡∏î field ‡πÅ‡∏õ‡∏•‡∏Å ‡πÜ ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô schema ‡∏ó‡∏¥‡πâ‡∏á

---

### 5) ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error

```javascript
  if (error) {
    const validationErrors = error.details.map(detail => ({
      field: detail.path[0],
      message: detail.message
    }));

    console.log('‚ùå Validation failed:', validationErrors);
    return sendError(res, 'Validation failed', 400, validationErrors);
  }
```

üìñ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢:

* ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ error ‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î field ‡πÅ‡∏•‡∏∞ message
* ‡∏™‡πà‡∏á response ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á client ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `sendError`
* ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á response:

```json
{
  "success": false,
  "message": "Validation failed",
  "errors": [
    { "field": "email", "message": "Please provide a valid email address" }
  ]
}
```

---

### 6) ‡∏Å‡∏£‡∏ì‡∏µ‡∏ú‡πà‡∏≤‡∏ô validation

```javascript
  req.body = value;
  next();
};
```

* ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏à‡∏∞ replace `req.body` ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà Joi ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß
* ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `next()` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á controller

---

### 7) Middleware: **validateStatusUpdate** (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏≥)

```javascript
const validateStatusUpdate = (req, res, next) => {
  return sendError(res, 'TODO: Implement validateStatusUpdate middleware', 501);
};
```

üìñ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢:

* ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ implement ‚Üí ‡∏™‡πà‡∏á error 501 (Not Implemented) ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ
* ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÄ‡∏≠‡∏á ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `schemas.statusUpdate` ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö `validateAgent`

---

### ‚ö†Ô∏è **Step 9: Error Handling (20 ‡∏ô‡∏≤‡∏ó‡∏µ - ‡πÉ‡∏´‡πâ code ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)**

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `middleware/errorHandler.js`:**

```javascript
// middleware/errorHandler.js - Professional error handling
const { sendError } = require('../utils/apiResponse');

const globalErrorHandler = (err, req, res, next) => {
  console.error('üö® Global Error Handler:', {
    error: err.message,
    stack: process.env.NODE_ENV === 'development' ? err.stack : undefined,
    url: req.originalUrl,
    method: req.method
  });

  // Joi validation errors
  if (err.isJoi) {
    const validationErrors = err.details.map(detail => ({
      field: detail.path[0],
      message: detail.message
    }));
    return sendError(res, 'Validation failed', 400, validationErrors);
  }

  // Default server error
  const message = process.env.NODE_ENV === 'production' 
    ? 'Internal server error' 
    : err.message;
    
  return sendError(res, message, 500);
};

const notFoundHandler = (req, res) => {
  console.log(`üîç 404 Not Found: ${req.method} ${req.originalUrl}`);
  return sendError(res, `Route ${req.originalUrl} not found`, 404);
};

// Performance monitoring middleware
const performanceMonitor = (req, res, next) => {
  const startTime = Date.now();
  
  res.on('finish', () => {
    const duration = Date.now() - startTime;
    
    if (duration > 1000) {
      console.warn(`üêå Slow request: ${req.method} ${req.url} took ${duration}ms`);
    }
    
    console.log(`‚ö° ${req.method} ${req.url}: ${duration}ms - ${res.statusCode}`);
  });
  
  next();
};

module.exports = { globalErrorHandler, notFoundHandler, performanceMonitor };
```

### üìù **Learning Check Point - Hour 3:**

```markdown
### ‚úÖ **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à**
1. **‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á Joi validation ‡∏Å‡∏±‡∏ö if/else validation**
2. **Global error handler ‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á?** 3. **Performance monitor ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡πÉ‡∏ô real-time system?**
```

### üõ§Ô∏è **Step 10: Routes Setup (15 ‡∏ô‡∏≤‡∏ó‡∏µ - ‡πÉ‡∏´‡πâ code ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)**

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `routes/agents.js`:**

```javascript
// routes/agents.js - ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° routes ‡∏Å‡∏±‡∏ö controllers
const express = require('express');
const agentController = require('../controllers/agentController');
const { validateAgent, validateStatusUpdate } = require('../middleware/validation');

const router = express.Router();

// GET /api/agents - List all agents
router.get('/', agentController.getAllAgents);

// GET /api/agents/status/summary - ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô /:id route
router.get('/status/summary', agentController.getStatusSummary);

// GET /api/agents/:id - Get specific agent
router.get('/:id', agentController.getAgentById);

// POST /api/agents - Create new agent (with validation)
router.post('/', validateAgent, agentController.createAgent);

// PUT /api/agents/:id - Update agent
router.put('/:id', agentController.updateAgent);

// PATCH /api/agents/:id/status - Update status (with validation)
router.patch('/:id/status', validateStatusUpdate, agentController.updateAgentStatus);

// DELETE /api/agents/:id - Delete agent
router.delete('/:id', agentController.deleteAgent);

module.exports = router;
```

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `routes/index.js`:**

```javascript
// routes/index.js - Routes aggregator
const express = require('express');
const agentRoutes = require('./agents');

const router = express.Router();

// API health check
router.get('/health', (req, res) => {
  res.json({
    success: true,
    status: 'OK',
    uptime: Math.floor(process.uptime()),
    timestamp: new Date().toISOString(),
    version: '1.0.0',
    environment: process.env.NODE_ENV || 'development'
  });
});

// API documentation
router.get('/docs', (req, res) => {
  res.json({
    title: 'Agent Wallboard API Documentation',
    version: '1.0.0',
    baseUrl: `${req.protocol}://${req.get('host')}`,
    endpoints: {
      'GET /api/health': 'API health check',
      'GET /api/agents': 'List all agents (supports ?status= and ?department=)',
      'POST /api/agents': 'Create new agent',
      'GET /api/agents/:id': 'Get specific agent',
      'PUT /api/agents/:id': 'Update agent information',
      'PATCH /api/agents/:id/status': 'Update agent status',
      'DELETE /api/agents/:id': 'Delete agent',
      'GET /api/agents/status/summary': 'Agent status summary'
    },
    examples: {
      createAgent: {
        method: 'POST',
        url: '/api/agents',
        body: {
          agentCode: 'A999',
          name: 'John Doe',
          email: 'john@company.com',
          department: 'Sales',
          skills: ['Thai', 'English']
        }
      }
    }
  });
});

// Mount agent routes
router.use('/agents', agentRoutes);

module.exports = router;
```

### üñ•Ô∏è **Step 11: Main Server (15 ‡∏ô‡∏≤‡∏ó‡∏µ - ‡πÉ‡∏´‡πâ code ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)**

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `server.js`:**

```javascript
// server.js - Main application server
const express = require('express');
const cors = require('cors');
const helmet = require('helmet');
const morgan = require('morgan');
require('dotenv').config();

// Import routes ‡πÅ‡∏•‡∏∞ middleware
const routes = require('./routes');
const { globalErrorHandler, notFoundHandler, performanceMonitor } = require('./middleware/errorHandler');

const app = express();
const PORT = process.env.PORT || 3001;

// Security middleware
app.use(helmet());

// CORS configuration
app.use(cors({
  origin: process.env.FRONTEND_URL || 'http://localhost:3000',
  credentials: true
}));

// Body parsing middleware
app.use(express.json({ limit: '10mb' }));
app.use(express.urlencoded({ extended: true }));

// Request logging (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ development)
if (process.env.NODE_ENV !== 'production') {
  app.use(morgan('dev'));
}

// Performance monitoring
app.use(performanceMonitor);

// Root endpoint
app.get('/', (req, res) => {
  res.json({
    success: true,
    message: 'Agent Wallboard API Enhanced v1.0',
    version: '1.0.0',
    environment: process.env.NODE_ENV || 'development',
    documentation: '/api/docs',
    health: '/api/health',
    endpoints: {
      agents: '/api/agents',
      health: '/api/health',
      docs: '/api/docs'
    }
  });
});

// API routes
app.use('/api', routes);

// Error handlers (‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î)
app.use('*', notFoundHandler);
app.use(globalErrorHandler);

// Start server
const server = app.listen(PORT, () => {
  console.log('üöÄ Agent Wallboard API Enhanced');
  console.log(`üì° Server running on http://localhost:${PORT}`);
  console.log(`üìö API Documentation: http://localhost:${PORT}/api/docs`);
  console.log(`üíö Health Check: http://localhost:${PORT}/api/health`);
  console.log(`üåç Environment: ${process.env.NODE_ENV || 'development'}`);
});

// Graceful shutdown (‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Phase 3)
process.on('SIGTERM', () => {
  console.log('üõë SIGTERM received, shutting down gracefully');
  server.close(() => {
    console.log('‚úÖ Process terminated');
  });
});

module.exports = app;
```

-----

## ‚è∞ **HOUR 4: Testing & Integration (70 ‡∏ô‡∏≤‡∏ó‡∏µ)**

### üß™ **Step 12: Complete Testing Guide (35 ‡∏ô‡∏≤‡∏ó‡∏µ)**

#### **Test Setup:**

1.  **‡πÄ‡∏õ‡∏¥‡∏î Terminal ‡∏£‡∏±‡∏ô server:**

<!-- end list -->

```bash
npm run dev
```

2.  **‡πÄ‡∏õ‡∏¥‡∏î Postman ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ curl**
3.  **Test ‡∏ï‡∏≤‡∏° sequence ‡∏ô‡∏µ‡πâ:**

#### **Test Case 1: System Health (5 ‡∏ô‡∏≤‡∏ó‡∏µ)**

```bash
# Request
GET http://localhost:3001/

# Expected Response (Status: 200)
{
  "success": true,
  "message": "Agent Wallboard API Enhanced v1.0",
  "version": "1.0.0",
  "environment": "development",
  "documentation": "/api/docs"
}

# Health Check
GET http://localhost:3001/api/health

# Expected Response (Status: 200)
{
  "success": true,
  "status": "OK",
  "uptime": 45,
  "timestamp": "2025-01-01T10:00:00.000Z"
}
```

#### **Test Case 2: Get All Agents (10 ‡∏ô‡∏≤‡∏ó‡∏µ)**

```bash
# Request
GET http://localhost:3001/api/agents

# Expected Response (Status: 200)
{
  "success": true,
  "message": "Agents retrieved successfully",
  "count": 3,
  "data": [
    {
      "id": "generated-id-1",
      "agentCode": "A001",
      "name": "John Doe",
      "email": "john.doe@company.com",
      "department": "Sales",
      "skills": ["Thai", "English", "Sales"],
      "status": "Available"
    }
    // ... more agents
  ]
}

# Test filtering
GET http://localhost:3001/api/agents?status=Available
GET http://localhost:3001/api/agents?department=Sales
```

#### **Test Case 3: Create Agent - Success (10 ‡∏ô‡∏≤‡∏ó‡∏µ)**

```bash
# Request
POST http://localhost:3001/api/agents
Content-Type: application/json

{
  "agentCode": "A999",
  "name": "Test Agent",
  "email": "test@company.com",
  "department": "Sales",
  "skills": ["Thai", "English"]
}

# Expected Response (Status: 201)
{
  "success": true,
  "message": "Agent created successfully",
  "data": {
    "id": "auto-generated",
    "agentCode": "A999",
    "name": "Test Agent",
    "email": "test@company.com",
    "department": "Sales",
    "skills": ["Thai", "English"],
    "status": "Available",
    "isActive": true,
    "createdAt": "2025-01-01T10:00:00.000Z"
  }
}
```

#### **Test Case 4: Validation Testing (10 ‡∏ô‡∏≤‡∏ó‡∏µ)**

```bash
# Request - Invalid data (‡∏ó‡∏î‡∏™‡∏≠‡∏ö Joi validation)
POST http://localhost:3001/api/agents
Content-Type: application/json

{
  "agentCode": "invalid-format",
  "name": "X",
  "email": "not-email"
}

# Expected Response (Status: 400)
{
  "success": false,
  "message": "Validation failed",
  "errors": [
    {
      "field": "agentCode",
      "message": "Agent code must be in format A001 (letter + 3 digits)"
    },
    {
      "field": "name",
      "message": "Name must be at least 2 characters"
    },
    {
      "field": "email",
      "message": "Please provide a valid email address"
    }
  ]
}
```

### üìä **Step 13: Status Management Testing (20 ‡∏ô‡∏≤‡∏ó‡∏µ)**

#### **Test Status Update - Valid Transition:**

```bash
# Get agent ID first
GET http://localhost:3001/api/agents

# Copy agent ID ‡πÅ‡∏•‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö status update
PATCH http://localhost:3001/api/agents/[AGENT-ID]/status
Content-Type: application/json

{
  "status": "Busy",
  "reason": "Handling customer call"
}

# Expected Response (Status: 200)
{
  "success": true,
  "message": "Agent status updated to Busy",
  "data": {
    "id": "agent-id",
    "agentCode": "A001", 
    "status": "Busy",
    "lastStatusChange": "2025-01-01T10:05:00.000Z"
  }
}
```

#### **Test Invalid Status Transition:**

```bash
# Try invalid transition (Available -> Offline without proper flow)
PATCH http://localhost:3001/api/agents/[AGENT-ID]/status
Content-Type: application/json

{
  "status": "Wrap"
}

# Expected Response (Status: 400)
{
  "success": false,
  "message": "Cannot change from Busy to Wrap. Valid transitions: Available, Wrap, Not Ready"
}
```

### üìö **Step 14: Documentation Creation (15 ‡∏ô‡∏≤‡∏ó‡∏µ)**

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `README.md`:**

````markdown
# Agent Wallboard API - Enhanced Phase 1

> Professional Node.js API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Call Center Agents ‡πÅ‡∏ö‡∏ö Real-time

## ‚ú® Features Enhanced
- üèóÔ∏è Professional MVC project structure  
- ‚úÖ Input validation with Joi
- üõ°Ô∏è Security middleware (Helmet)
- üìù Request logging ‡πÅ‡∏•‡∏∞ performance monitoring
- ‚ö†Ô∏è Global error handling
- üìä Consistent API response format

## üöÄ Quick Start

```bash
# 1. Clone ‡πÅ‡∏•‡∏∞ install dependencies
npm install

# 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á environment file
cp .env.example .env

# 3. Start development server
npm run dev

# 4. Test API
curl http://localhost:3001/api/health
````

## üîó API Endpoints

### üìä System Information

  - `GET /` - API information
  - `GET /api/health` - Health check
  - `GET /api/docs` - API documentation

### üë• Agent Management

  - `GET /api/agents` - List agents (supports `?status=` ‡πÅ‡∏•‡∏∞ `?department=`)
  - `GET /api/agents/:id` - Get specific agent
  - `POST /api/agents` - Create agent (requires validation)
  - `PUT /api/agents/:id` - Update agent information
  - `DELETE /api/agents/:id` - Delete agent

### üìà Status Management

  - `PATCH /api/agents/:id/status` - Update agent status (with transition validation)
  - `GET /api/agents/status/summary` - Status summary statistics

## üß™ Testing

### Manual Testing

```bash
# 1. Health check
curl http://localhost:3001/api/health

# 2. Get all agents
curl http://localhost:3001/api/agents

# 3. Create new agent
curl -X POST http://localhost:3001/api/agents \
  -H "Content-Type: application/json" \
  -d '{"agentCode":"A999","name":"Test Agent","email":"test@company.com","department":"Sales"}'
```

### Postman Collection

  - Import collection: `Agent_Wallboard_API_Enhanced.postman_collection.json`
  - ‡∏°‡∏µ test cases ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏° success ‡πÅ‡∏•‡∏∞ error scenarios

## ‚öôÔ∏è Configuration

### Environment Variables

```env
PORT=3001                           # Server port
NODE_ENV=development                # Environment mode
FRONTEND_URL=http://localhost:3000  # CORS origin
```

### Agent Status Flow

```
Available ‚Üí Busy ‚Üí Wrap ‚Üí Available
    ‚Üì        ‚Üì       ‚Üì
  Break   Not Ready  ‚Üì
    ‚Üì        ‚Üì    Available  
Not Ready  Available
    ‚Üì
 Offline
```

```
```


## üö® Troubleshooting

### Common Issues
```bash
# Issue: "AGENT_STATUS is not defined"
# Solution: Check imports ‡πÉ‡∏ô constants.js

# Issue: Validation ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
# Solution: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö middleware order ‡πÉ‡∏ô routes

# Issue: CORS error
# Solution: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö FRONTEND_URL ‡πÉ‡∏ô .env
```

## üéØ Next Steps (Phase 2)
- Database integration (MSSQL + MongoDB)
- JWT authentication
- WebSocket real-time features
- Advanced logging ‡πÅ‡∏•‡∏∞ monitoring

## üìû Support
- Office Hours: [‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤]
- Email: [‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå]
- Issues: GitHub Issues tab

---

## üí° **‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏≥‡πÄ‡∏≠‡∏á Section (TODO Completion)**

### ‚úçÔ∏è **TODO #1: Complete getAllAgents (10 ‡∏ô‡∏≤‡∏ó‡∏µ)**

**Function:** `getAllAgents` ‡πÉ‡∏ô `controllers/agentController.js`

**Requirements:**
1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• agents ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Map storage
2. ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö query filtering: `?status=Available` ‡πÅ‡∏•‡∏∞ `?department=Sales`
3. ‡∏™‡πà‡∏á response ‡∏î‡πâ‡∏ß‡∏¢ `sendSuccess` helper
4. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏î‡πâ‡∏ß‡∏¢ try-catch

**Hints:**
```javascript
// 1. Get all agents from Map
const { status, department } = req.query;
let agentList = Array.from(agents.values());

// 2. Apply filters
if (status) {
  agentList = agentList.filter(agent => agent.status === status);
}

// 3. Send response
return sendSuccess(res, 'Agents retrieved successfully', 
  agentList.map(agent => agent.toJSON())
);
```

**Expected Output:**
- ‚úÖ GET `/api/agents` ‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô agents ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‚úÖ GET `/api/agents?status=Available` filter ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Available agents
- ‚úÖ Response format ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° `sendSuccess` pattern

### ‚úçÔ∏è **TODO #2: Complete createAgent (15 ‡∏ô‡∏≤‡∏ó‡∏µ)**

**Function:** `createAgent` ‡πÉ‡∏ô `controllers/agentController.js`

**Requirements:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ `agentCode` ‡∏ã‡πâ‡∏≥‡πÑ‡∏´‡∏°
2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Agent instance ‡πÉ‡∏´‡∏°‡πà
3. ‡πÄ‡∏Å‡πá‡∏ö‡∏•‡∏á Map storage  
4. ‡∏™‡πà‡∏á response ‡∏û‡∏£‡πâ‡∏≠‡∏° status code 201

**Hints:**
```javascript
// 1. Check duplicate
const existingAgent = Array.from(agents.values())
  .find(agent => agent.agentCode === agentData.agentCode);

if (existingAgent) {
  return sendError(res, `Agent code ${agentData.agentCode} already exists`, 409);
}

// 2. Create new agent
const newAgent = new Agent(agentData);
agents.set(newAgent.id, newAgent);

// 3. Success response
return sendSuccess(res, API_MESSAGES.AGENT_CREATED, newAgent.toJSON(), 201);
```

### ‚úçÔ∏è **TODO #3: Complete updateAgentStatus (15 ‡∏ô‡∏≤‡∏ó‡∏µ - Advanced)**

**Function:** `updateAgentStatus` ‡πÉ‡∏ô `controllers/agentController.js`

**Requirements:**
1. ‡∏´‡∏≤ agent ‡∏à‡∏≤‡∏Å ID parameter
2. Validate status ‡∏î‡πâ‡∏ß‡∏¢ `AGENT_STATUS` constants
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö valid transition ‡∏î‡πâ‡∏ß‡∏¢ `VALID_STATUS_TRANSITIONS`
4. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ `agent.updateStatus()` method
5. ‡∏™‡πà‡∏á response ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• agent ‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏•‡πâ‡∏ß

**Hints:**
```javascript
const { id } = req.params;
const { status, reason } = req.body;
const agent = agents.get(id);

// Validation checks
if (!agent) {
  return sendError(res, API_MESSAGES.AGENT_NOT_FOUND, 404);
}

if (!Object.values(AGENT_STATUS).includes(status)) {
  return sendError(res, `Invalid status. Valid: ${Object.values(AGENT_STATUS).join(', ')}`, 400);
}

// Transition validation
const currentStatus = agent.status;
const validTransitions = VALID_STATUS_TRANSITIONS[currentStatus];

if (!validTransitions.includes(status)) {
  return sendError(res, 
    `Cannot change from ${currentStatus} to ${status}. Valid: ${validTransitions.join(', ')}`, 
    400
  );
}
```

### ‚úçÔ∏è **TODO #4: Complete statusUpdate Schema (15 ‡∏ô‡∏≤‡∏ó‡∏µ)**

**File:** `schemas.statusUpdate` ‡πÉ‡∏ô `middleware/validation.js`

**Requirements:**
1. `status` field ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô valid `AGENT_STATUS` ‡πÅ‡∏•‡∏∞ required
2. `reason` field ‡πÄ‡∏õ‡πá‡∏ô optional string ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 200 characters  
3. ‡πÉ‡∏™‡πà custom error messages ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°

**Solution:**
```javascript
statusUpdate: Joi.object({
  status: Joi.string()
    .valid(...Object.values(AGENT_STATUS))
    .required()
    .messages({
      'any.only': `Status must be one of: ${Object.values(AGENT_STATUS).join(', ')}`,
      'any.required': 'Status is required'
    }),
  
  reason: Joi.string()
    .max(200)
    .optional()
    .messages({
      'string.max': 'Reason cannot exceed 200 characters'
    })
})
```

### ‚úçÔ∏è **TODO #5: Complete validateStatusUpdate (10 ‡∏ô‡∏≤‡∏ó‡∏µ)**

**Function:** `validateStatusUpdate` ‡πÉ‡∏ô `middleware/validation.js`

**Requirements:**
- ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô `validateAgent` ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ `schemas.statusUpdate`
- ‡∏™‡πà‡∏á validation errors ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô

**Solution Pattern:**
```javascript
const validateStatusUpdate = (req, res, next) => {
  const { error, value } = schemas.statusUpdate.validate(req.body, {
    abortEarly: false,
    stripUnknown: true
  });

  if (error) {
    const validationErrors = error.details.map(detail => ({
      field: detail.path[0], 
      message: detail.message
    }));

    return sendError(res, 'Status validation failed', 400, validationErrors);
  }

  req.body = value;
  next();
};
```

---

## üìä **Learning Check Points**

### ‚úÖ **Hour 2 Check Point:**
1. **‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Controller ‡πÅ‡∏•‡∏∞ Route**
   - Route: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î endpoint ‡πÅ‡∏•‡∏∞ HTTP methods
   - Controller: business logic ‡πÅ‡∏•‡∏∞ data processing

2. **‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ `sendSuccess` ‡πÅ‡∏•‡∏∞ `sendError` helpers?**
   - Consistent response format
   - ‡∏•‡∏î code duplication
   - ‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£ maintain

3. **Status transition validation ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏∞‡πÑ‡∏£?**
   - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô invalid status changes
   - ‡∏£‡∏±‡∏Å‡∏©‡∏≤ business rules
   - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô data inconsistency

### ‚úÖ **Hour 3 Check Point:**
1. **‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡∏≠‡∏á Joi validation ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö manual validation**
   - Schema-based, declarative
   - Rich validation rules built-in
   - Better error messages
   - Type coercion ‡πÅ‡∏•‡∏∞ sanitization

2. **Global error handler ‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡∏∞‡πÑ‡∏£?**
   - Centralized error processing
   - Consistent error responses
   - Logging ‡πÅ‡∏•‡∏∞ monitoring
   - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô server crash

---

## üÜò **Troubleshooting Guide**

### **Issue 1: Cannot Start Server**
```bash
# Error: "Cannot find module"
# Solution: 
npm install

# Error: "Port already in use"
# Solution:
killall node
# ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô PORT ‡πÉ‡∏ô .env
```

### **Issue 2: TODO Functions Return 501 Error**
```bash
# Error: "TODO: Implement getAllAgents function"  
# Solution: Replace TODO code ‡∏î‡πâ‡∏ß‡∏¢ implementation ‡∏à‡∏£‡∏¥‡∏á

# Example:
return sendError(res, 'TODO: Implement function', 501);
# ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô:
return sendSuccess(res, 'Success message', data);
```

### **Issue 3: Validation Not Working**
```bash
# Error: Validation ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
# Solution: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö middleware order ‡πÉ‡∏ô routes

# ‚ùå ‡∏ú‡∏¥‡∏î
router.post('/', agentController.createAgent);

# ‚úÖ ‡∏ñ‡∏π‡∏Å
router.post('/', validateAgent, agentController.createAgent);
```

### **Issue 4: CORS Errors**
```bash
# Error: CORS policy blocking requests
# Solution: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö FRONTEND_URL ‡πÉ‡∏ô .env file
FRONTEND_URL=http://localhost:3000

# ‡∏´‡∏£‡∏∑‡∏≠ disable CORS ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (development only):
app.use(cors({ origin: '*' }));
```

---

## üéØ **Enhanced 20% Challenge (‡πÅ‡∏ö‡πà‡∏á‡∏ï‡∏≤‡∏° Levels)**

### ‚≠ê **Level 1: Beginner (5-10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©)**

#### 1. **Enhanced Health Check (5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)**
‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô `/api/health` endpoint:
```javascript
// TODO: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• system info
{
  "success": true,
  "status": "OK",
  "uptime": 45,
  "memoryUsage": process.memoryUsage(),
  "agentCount": agents.size,
  "timestamp": new Date().toISOString()
}
```

#### 2. **Request Logging Enhancement (5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)**
‡πÄ‡∏û‡∏¥‡πà‡∏° custom request logging:
```javascript
// TODO: ‡∏™‡∏£‡πâ‡∏≤‡∏á custom logger middleware
// Log: timestamp, method, URL, response time, status code
```

#### 3. **API Rate Limiting (10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)**
‡πÄ‡∏û‡∏¥‡πà‡∏° rate limiting middleware:
```bash
npm install express-rate-limit
```

### ‚≠ê‚≠ê **Level 2: Intermediate (10-15 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©)**

#### 1. **Agent Search API (10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)**
```javascript
// GET /api/agents/search?q=john&fields=name,email
// ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ agent ‡πÉ‡∏ô name, email, agentCode fields
// ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö fields parameter ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
```

#### 2. **Department Statistics (10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)**
```javascript  
// GET /api/agents/departments/stats
// ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° department
{
  "departments": {
    "Sales": {"total": 5, "available": 3, "busy": 2},
    "Support": {"total": 3, "available": 1, "busy": 1, "break": 1}
  }
}
```

#### 3. **Status History API (15 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)**
```javascript
// GET /api/agents/:id/status/history  
// ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‡∏û‡∏£‡πâ‡∏≠‡∏° pagination
// ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö ?page=1&limit=10&from_date=&to_date=
```

### ‚≠ê‚≠ê‚≠ê **Level 3: Advanced (15-20 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©)**

#### 1. **OpenAPI Documentation (15 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)**
```bash
npm install swagger-ui-express swagger-jsdoc
```
‡∏™‡∏£‡πâ‡∏≤‡∏á Swagger documentation ‡∏ó‡∏µ‡πà `/api-docs`

#### 2. **Input Sanitization (15 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)**  
```bash
npm install xss validator
```
‡πÄ‡∏û‡∏¥‡πà‡∏° XSS protection ‡πÅ‡∏•‡∏∞ input sanitization

#### 3. **Graceful Shutdown & Health Monitoring (20 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)**
```javascript
// TODO: Implement graceful shutdown
// TODO: Advanced health checks with dependencies
// TODO: Metrics collection endpoint
```

---

## üîÑ **‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Phase 2**

### **Database Abstraction Layer (Preview)**
```javascript
// models/AgentRepository.js - ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Phase 2
class AgentRepository {
  constructor() {
    // Phase 1: ‡πÉ‡∏ä‡πâ Map storage
    this.storage = new Map();
    
    // Phase 2: ‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô database
    // this.db = require('../config/database');
  }

  async findAll(filters = {}) {
    // Phase 1: ‡∏à‡∏≤‡∏Å Map
    let agents = Array.from(this.storage.values());
    
    // Apply filters
    if (filters.status) {
      agents = agents.filter(agent => agent.status === filters.status);
    }
    
    return agents;
    
    // Phase 2: ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô
    // return await this.db.collection('agents').find(filters).toArray();
  }

  async save(agent) {
    // Phase 1: save to Map
    this.storage.set(agent.id, agent);
    return agent;
    
    // Phase 2: ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô  
    // return await this.db.collection('agents').insertOne(agent);
  }
}
```

### **API Versioning Structure**
```javascript
// routes/index.js - ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° versioning
// API version 1 (Phase 1 features)
router.use('/v1/agents', agentRoutes);

// API version 2 (Phase 2+ features) 
// router.use('/v2/agents', agentRoutesV2);

// Default ‡πÑ‡∏õ‡∏ó‡∏µ‡πà latest version
router.use('/agents', agentRoutes);
```

---

## üìÖ **Timeline & Deliverables**

### **üìã Checklist ‡∏ó‡πâ‡∏≤‡∏¢ Phase 1:**
- [ ] ‚úÖ All TODO functions implemented ‡πÅ‡∏•‡∏∞ tested
- [ ] üß™ Postman collection ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å test cases  
- [ ] üìö README.md documentation complete
- [ ] üîß Environment configuration setup ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- [ ] ‚ö†Ô∏è Error handling ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å scenarios
- [ ] üìä API responses consistent ‡πÅ‡∏•‡∏∞ professional

### **üéØ Success Criteria:**
1. **Functional APIs (40%)** - ‡∏ó‡∏∏‡∏Å endpoint ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
2. **Code Quality (30%)** - MVC structure, clean code, proper naming
3. **Error Handling (15%)** - Validation ‡πÅ‡∏•‡∏∞ error responses
4. **Documentation (10%)** - README ‡πÅ‡∏•‡∏∞ API docs  
5. **Testing (5%)** - Postman collection ‡πÅ‡∏•‡∏∞ manual testing

### **üìà Phase 2 Readiness:**
- ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à MVC pattern ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ
- ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à middleware concept ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö authentication
- API structure ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö database integration
- Error handling pattern ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö production

---

## üåü **Real-World Context**

### **üíº Skills ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Phase 1:**
- ‚úÖ **Backend API Development** (Node.js + Express)
- ‚úÖ **Input Validation & Security** (Joi + Helmet)
- ‚úÖ **Error Handling Patterns** (Global error handler)
- ‚úÖ **API Design Principles** (RESTful + consistent responses)
- ‚úÖ **Code Organization** (MVC + separation of concerns)
- ‚úÖ **API Testing & Documentation** (Postman + documentation)

### **üè¢ Career Applications:**
- üíº **Backend Developer** positions
- üíº **Full-Stack Developer** roles  
- üíº **API Developer** specialized positions
- üíº **DevOps Engineer** (foundation skills)

### **üöÄ Industry Relevance:**
- **Call Centers:** Agent management systems
- **Customer Service:** Support ticket routing
- **Remote Teams:** Status tracking systems
- **Help Desk:** Technician availability monitoring

**Phase 1 ‡πÉ‡∏´‡πâ foundation ‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ enterprise-grade applications!**
